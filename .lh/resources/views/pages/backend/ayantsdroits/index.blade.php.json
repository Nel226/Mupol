{
    "sourceFile": "resources/views/pages/backend/ayantsdroits/index.blade.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1732793802719,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1732793802719,
            "name": "Commit-0",
            "content": "<div class=\"\">\n    <div class=\"flex items-center justify-end py-2 mb-6 space-x-2 text-sm\">\n        <div class=\"flex items-center space-x-2\">\n            <a href=\"{{ route('ayantsdroits.create') }}\">\n                <x-primary-button class=\"\">\n                    {{ __('Ajouter Ayant Droit') }}\n                </x-primary-button>\n            </a>\n        </div>\n        <!-- Custom search input -->\n        <div class=\"relative mt-1\">\n            <input type=\"text\" id=\"fSearchAyantDroit\" name=\"fSearchAyantDroit\" class=\"block pt-2 text-sm text-gray-900 border border-gray-300 rounded-lg ps-10 w-80 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500\" placeholder=\"Rechercher\">\n            <div class=\"absolute inset-y-0 flex items-center pointer-events-none rtl:inset-r-0 start-0 ps-3\">\n                <svg class=\"w-4 h-4 text-gray-500 dark:text-gray-400\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 20 20\">\n                    <path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z\"/>\n                </svg>\n            </div>\n        </div>\n    </div>\n    \n    <div>\n        <ul class=\"flex overflow-x-auto border-b border-gray-900\" id=\"myTabAyantDroit\" role=\"tablist\">\n            @foreach($sheetsAyantsDroits as $yearMonth => $data)\n                <li class=\"flex-none\" role=\"presentation\">\n                    <button class=\"nav-link-ayantdroit text-sm border-gray-300 border-2 px-4 py-2 rounded-t-lg {{ $loop->first ? 'bg-primary1 text-white' : 'bg-gray-200 text-gray-600 hover:bg-gray-300' }}\" id=\"tab-{{ $yearMonth }}-ayantdroit-tab\" data-bs-toggle=\"tab\" data-bs-target=\"#tab-{{ $yearMonth }}-ayantdroit\" type=\"button\" role=\"tab\" aria-controls=\"tab-{{ $yearMonth }}-ayantdroit\" aria-selected=\"{{ $loop->first ? 'true' : 'false' }}\">\n                        {{ $yearMonth }}\n                    </button>\n                </li>\n            @endforeach\n        </ul>\n        <div class=\"tab-content\" id=\"myTabAyantDroitContent\">\n            @foreach($sheetsAyantsDroits as $yearMonth => $data)\n                <div class=\"tab-pane-ayantdroit {{ $loop->first ? 'block' : 'hidden' }}\" id=\"tab-{{ $yearMonth }}-ayantdroit\" role=\"tabpanel\" aria-labelledby=\"tab-{{ $yearMonth }}-ayantdroit-tab\">\n                    \n                    <div id=\"tabulator-{{ $yearMonth }}-ayantdroit\" class=\"w-full p-2 overflow-x-auto bg-white rounded-b-lg shadow-lg\">\n                        <!-- Tabulator table for Ayants Droit will be initialized here -->\n                    </div>\n                    <div class=\"flex justify-end mt-2 space-x-2\">\n                        <x-primary-button class=\"export-btn-ayantdroit\" data-year-month=\"{{ $yearMonth }}\">\n                            {{ __('Exporter en XLSX') }}\n                        </x-primary-button>\n                    </div>\n                </div>\n            @endforeach\n        </div>\n    </div>\n</div>\n\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        const tabulatorsAyantsDroits = {};\n        const baseUrl = @json(route('ayantsdroits.edit', ['ayantsdroit' => ':id'])); // URL de base\n        \n        @foreach($sheetsAyantsDroits as $yearMonth => $data)\n            tabulatorsAyantsDroits[\"{{ $yearMonth }}\"] = new Tabulator(\"#tabulator-{{ $yearMonth }}-ayantdroit\", {\n                data: @json($data),\n                layout: \"fitDataStretch\",\n                movableColumns: false,\n                placeholder: \"Aucune donnée\",\n                pagination: \"local\",\n                paginationSize: 20,\n                paginationSizeSelector: [20, 30, 40, 50],\n                printAsHtml: true,\n                columns: [\n                    { \n                        title: \"N° Ordre\", \n                        field: \"numero_ordre\", \n                        formatter: \"rownum\",  \n                        hozAlign: \"center\", \n                        headerSort: false \n                    },\n                    @foreach($headerAyantDroit as $column)\n                        { title: \"{{ ucfirst($column) }}\", field: \"{{ $column }}\" },\n                    @endforeach\n                    {\n                        title: \"Actions\", \n                        \n                        formatter: function(cell, formatterParams, onRendered) {\n                                const rowData = cell.getData();\n                                \n                                const editUrl = baseUrl.replace(':id', rowData.id); \n\n                                return `\n                                    <a href=\"${editUrl}\" class='border border-indigo-500 shadow-lg rounded-lg text-bold text-white p-1  bg-indigo-500 btn btn-primary'>Modifier</a>\n                                    <button class='border border-red-500 rounded-lg bg-red-800 shadow-lg btn btn-danger text-bold text-white p-1' data-id=\"${rowData.id}\">Supprimer</button>\n                                    `;\n                        },\n                        hozAlign: \"center\",\n                        minWidth: 200,\n                        cellClick: function(e, cell) {\n                            const target = e.target;\n    \n                            if (target.classList.contains('btn-danger')) {\n                                showModal(target.getAttribute('data-id'));\n                            }\n                        },\n                        download: false \n                    }\n                ],\n            });\n        @endforeach\n    \n        function showModal(id) {\n            const modal = document.getElementById('confirmationModal');\n            modal.classList.remove('hidden');\n        \n            document.getElementById('modalMessage').innerText = `Êtes-vous sûr de vouloir supprimer l'élément avec l'ID: ${id} ?`;\n        \n            const baseUrl = @json(route('ayantsdroits.destroy', ['ayantsdroit' => ':id']));\n            const deleteUrl = baseUrl.replace(':id', id);\n        \n            // suppression\n            document.getElementById('confirmDeleteBtn').onclick = function() {\n                fetch(deleteUrl, {\n                    method: 'DELETE',\n                    headers: {\n                        'Content-Type': 'application/json',\n                        'X-CSRF-TOKEN': document.querySelector('meta[name=\"csrf-token\"]').getAttribute('content') // Token CSRF\n                    }\n                })\n                .then(response => {\n                    if (response.ok) {\n                        console.log('Suppression confirmée pour l\\'ID:', id);\n                        alert('Mutualiste supprimé avec succès.');\n\n                        modal.classList.add('hidden');\n        \n                        location.reload(); \n                    } else {\n                        return response.json().then(data => {\n                            console.error('Erreur lors de la suppression:', data.message);\n                        });\n                    }\n                })\n                .catch(error => {\n                    console.error('Erreur lors de la requête de suppression:', error);\n                });\n            };\n        \n            document.getElementById('cancelDeleteBtn').onclick = function() {\n                modal.classList.add('hidden');\n            };\n        }\n        \n        const tabsAyantDroit = document.querySelectorAll('.nav-link-ayantdroit');\n        tabsAyantDroit.forEach(tab => {\n            tab.addEventListener('click', function() {\n                document.querySelectorAll('.tab-pane-ayantdroit').forEach(pane => pane.classList.add('hidden'));\n                \n                tabsAyantDroit.forEach(link => {\n                    link.classList.remove('bg-primary1', 'text-white');\n                    link.classList.add('bg-gray-200', 'text-gray-600');\n                });\n    \n                const targetPane = document.querySelector(this.getAttribute('data-bs-target'));\n                targetPane.classList.remove('hidden');\n    \n                this.classList.remove('bg-gray-200', 'text-gray-600');\n                this.classList.add('bg-primary1', 'text-white');\n            });\n        });\n    \n        // recherche\n        document.getElementById('fSearchAyantDroit').addEventListener('input', function() {\n            const searchValue = this.value.toLowerCase();\n            Object.values(tabulatorsAyantsDroits).forEach(tabulator => {\n                tabulator.setFilter(function(data) {\n                    return Object.values(data).some(value => \n                        String(value).toLowerCase().includes(searchValue)\n                    );\n                });\n            });\n        });\n    \n        // exportation\n        document.querySelectorAll('.export-btn-ayantdroit').forEach(button => {\n            button.addEventListener('click', function() {\n                const yearMonth = this.getAttribute('data-year-month');\n                const tabulator = tabulatorsAyantsDroits[yearMonth];\n                tabulator.download(\"xlsx\", `ayantsdroits_${yearMonth}.xlsx`);\n            });\n        });\n    });\n</script>\n\n<form action=\"{{route('ayantdroits.import')}}\" method=\"POST\" enctype=\"multipart/form-data\">\n    @csrf\n    <div class=\"flex items-center justify-end my-4 space-x-2\">\n        <input type=\"file\" name=\"excel-file-ayant-droit\"  class=\"block text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-green-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400\" accept=\".csv, .xlsx\" />\n        <x-primary-button type=\"submit\" class=\"ms-3\">\n            {{ __('Importer Excel') }}\n        </x-primary-button>\n    </div>\n</form>"
        }
    ]
}